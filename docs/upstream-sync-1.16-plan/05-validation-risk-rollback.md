# 05. 验证、风险与回滚

## 1. 验证矩阵

## 1.1 构建与启动

1. `pnpm run build` 通过
2. `pnpm run tauri:dev` 可启动
3. 首屏初始化无阻塞（无注入链死循环、无关键异常）

## 1.2 核心功能回归

1. 角色：增删改查、导入导出、重命名
2. 聊天：加载、保存、重命名、删除、搜索
3. 群聊：加载、保存、导入、删除
4. 设置/密钥：读写、快照
5. 扩展：发现、安装、更新、删除、第三方资源加载

## 1.3 1.16 新功能触发点（最小验证）

1. 宏系统新语法入口可用（不报错）
2. 欢迎页 pin recent chat 行为正常
3. 背景元数据相关 UI 不崩溃
4. 新增接口调用命中本地接管或受控降级

## 1.4 Tauri 注入稳定性

1. `init.js -> tauri-main.js -> script.js` 顺序正确
2. `fetch` 与 `$.ajax` 拦截正常
3. `safeInvoke` 参数映射与重试策略生效
4. Android 场景大文件读写路径可用（asset/from-file）

## 2. 风险清单与缓解

## 2.1 高风险

1. `script.js` 合并导致初始化事件时序变化  
缓解：单文件单提交，保留事件差异对照清单。

2. 新增接口未接管导致请求落空  
缓解：以接口清单逐项验证，不留隐式缺口。

3. 扩展加载链回归（third-party/runtime）  
缓解：优先回归 `scripts/extensions.js` + `runtime/*`。

## 2.2 中风险

1. 宏系统与 slash 命令联动回归  
缓解：新增最小 E2E 命令脚本。

2. 样式与欢迎页行为偏差  
缓解：重点页面截图比对（桌面 + 移动）。

## 2.3 低风险

1. 本地化文本变化  
缓解：仅同步上游，不做二次改写。

## 3. 回滚策略

1. 按阶段回滚，不跨阶段回滚。
2. 每阶段保持独立提交，确保 `git revert <commit>` 可用。
3. 若 P0 阶段失败，立即回到“无冲突同步完成”的稳定点。
4. 严禁使用破坏性命令（如 `reset --hard`）处理未知问题。

## 4. 验收标准（DoD）

1. 上游 1.16 关键功能在 Tauri 下可运行或受控降级。
2. 前端主入口、注入层、后端命令契约一致。
3. 不新增明显冗余模块与临时兼容分支。
4. 文档与实现同步更新，可供下一轮迭代直接执行。

